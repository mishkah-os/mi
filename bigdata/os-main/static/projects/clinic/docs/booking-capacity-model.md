# ูููุฐุฌ ุฅุฏุงุฑุฉ ุงูุณุนุฉ ุงูุฏููุงููููุฉ (Dynamic Capacity Model)

ุจูุงุกู ุนูู ูุชุทูุจุงุช ุงูุชุดุบูู ุงูุญุงููุฉ (ููุธู ุงุณุชูุจุงู ูุงุญุฏุ ูุฑููุฉ ุงูุทุจูุจ ูู ุงูุชุนุงูู ูุน ุงูุฃุฌูุฒุฉ)ุ ุชู ุงุนุชูุงุฏ ูููุฐุฌ **"ุงูุณุนุฉ ุงูุฏููุงููููุฉ ุงููุจุณุทุฉ" (Simplified Dynamic Capacity)**.

## 1. ุงููุจุฏุฃ (Concept)

ุจุฏูุงู ูู ุญุฌุฒ "ููุงู ูุงุญุฏ" (Boolean Flag)ุ ูุฅู ูู ููุนุฏ (Slot) ููุซู "ูุนุงุกู ุฒูููุงู" (Time Bucket) ููุชูู ุณุนุฉ ูุตูู (Max Capacity).

- **ุงูุณุนุฉ (Capacity)**: ุงูุญุฏ ุงูุฃูุตู ูููุฑุถู ุงูุฐูู ูููู ููุทุจูุจ ุงูุฅุดุฑุงู ุนูููู ูู ูุฐุง ุงูููุช (ุนุงุฏุฉ 3).
- **ุงูุญูู (Load)**: ุนุฏุฏ ุงููุฑุถู ุงููุญุฌูุฒูู ุญุงููุงู.

## 2. ูููู ุงูุจูุงูุงุช (Data Structure)

ุชู ุชุญุฏูุซ ุฌุฏูู `clinic_slots_inventory` ููุฏุนู ุงูุนุฏุงุฏุงุช ุจุฏูุงู ูู ุงูุญุงูุฉ ุงูุซูุงุฆูุฉ.

```sql
TABLE clinic_slots_inventory (
    id UUID PRIMARY KEY,
    doctor_id UUID,          -- ุงูุทุจูุจ ุงููุงูู ููููุนุฏ
    slot_date DATE,          -- ุชุงุฑูุฎ ุงูููุนุฏ
    slot_time_start TIME,    -- ููุช ุงูุจุฏุงูุฉ (ูุซูุงู 10:00)
    slot_time_end TIME,      -- ููุช ุงูููุงูุฉ (ูุซูุงู 10:20)
    
    -- ุญููู ุงูุณุนุฉ ุงูุฌุฏูุฏุฉ
    capacity INTEGER DEFAULT 1,      -- ุงูุณุนุฉ ุงููุตูู (ูุซูุงู 3)
    booked_count INTEGER DEFAULT 0,  -- ุนุฏุฏ ุงูุญุฌูุฒุงุช ุงูุญุงููุฉ
    
    -- ุงูุญุงูุฉ ุงููุญุณูุจุฉ
    status VARCHAR GENERATED ALWAYS AS (
        CASE 
            WHEN booked_count >= capacity THEN 'Full'
            WHEN booked_count > 0 THEN 'Partial'
            ELSE 'Available'
        END
    ),
    
    is_active BOOLEAN DEFAULT TRUE   -- ูุชูุนูู/ุชุนุทูู ุงูููุนุฏ ููู
);
```

## 3. ููุทู ุงูุนูู (Business Logic)

### ุฃ. ุนุฑุถ ุงูููุงุนูุฏ (Viewing Availability)

ุนูุฏ ุทูุจ "ุฌุฏูู ุงูููุงุนูุฏ"ุ ุงููุธุงู ูููู ุจุงูุชุงูู:

1. ุฌูุจ ุงูู Slots ูููุชุฑุฉ ุงููุญุฏุฏุฉ.
2. ููู Slotุ ุญุณุงุจ "ุงูููุงุนุฏ ุงููุชุจููุฉ" (`Remaining = capacity - booked_count`).
3. ูู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ:
   - ๐ข **ุฃุฎุถุฑ (Available)**: ุฅุฐุง ูุงู `Remaining >= 1`.
   - ๐ด **ุฃุญูุฑ (Full)**: ุฅุฐุง ูุงู `Remaining == 0`.
   - ูููู ุนุฑุถ ูุต ุชูุถูุญู: *"ูุชุจูู 2 ูู 3 ุฃูุงูู"*.

### ุจ. ุนูููุฉ ุงูุญุฌุฒ (Booking Process)

ุจูุง ุฃููุง ููุชุฑุถ ูุฌูุฏ ููุธู ุงุณุชูุจุงู ูุงุญุฏ (No Concurrency Issues)ุ ูุฅู ุงูููุทู ูููู ูุจุงุดุฑุงู:

1. **ุงูุชุญูู (Check)**:
   ูุฑุงุกุฉ ุงูู Slot ุงููุทููุจ.
   `IF (slot.booked_count < slot.capacity) PROCEED`

2. **ุงูุชูููุฐ (Execute)**:
   - ุฅูุดุงุก ุณุฌู ูู `clinic_bookings` ูุฑุจุทู ุจูุฐุง ุงูู Slot.
   - ุชุญุฏูุซ ุงูุนุฏุงุฏ: `UPDATE clinic_slots_inventory SET booked_count = booked_count + 1 WHERE id = ...`

3. **ุงูุงูุชูุงุก (Full)**:
   ุนูุฏูุง ูุตู `booked_count` ุฅูู `capacity`ุ ูุฎุชูู ุงูุฒุฑ ุฃู ูุตุจุญ "ููุชูู".

## 4. ุงููููุฒุงุช (Advantages)

1. **ุจุณุงุทุฉ ุงูุชูููุฐ**: ูุง ูุญุชุงุฌ ูุฌุฏุงูู ุฅุถุงููุฉ ูููุญุทุงุช (Stations).
2. **ุงููุฑููุฉ**: ูููู ููุทุจูุจ ุชุนุฏูู ุณุนุฉ ุณุงุนุฉ ูุญุฏุฏุฉ (ูุซูุงู 11:00 ุณุนุชูุง 5 ูุฃู ูุนู ูุณุงุนุฏ ุฅุถุงูู) ุจุณูููุฉ ุจุชุนุฏูู ุฑูู.
3. **ูุถูุญ ุงูุจูุงูุงุช**: ุงุณุชุนูุงู SQL ูุงุญุฏ ูุนุทูู ูุณุจุฉ ุงูุฅุดุบุงู (`Occupancy Rate`) ููู ููู.

## 5. ุงููููุฏ ุงูููุจููุฉ (Accepted Trade-offs)

- **ุฅุฏุงุฑุฉ ุงูุฃุฌูุฒุฉ**: ููุชุฑุถ ุงููุธุงู ุฃู ุงูุทุจูุจ "ุณูุฏุจุฑ ุฃูุฑู" ูู ุชูุฒูุน ุงูุฃุฌูุฒุฉ (ููุฒุฑุ ุดุฏุ ูุณุงุฌ) ูุฏููุงู. ุงููุธุงู ูุถูู ููุท ุฃูุง ูุฒูุฏ ุงูุนุฏุฏ ุงูุฅุฌูุงูู ุนู 3.
- **ุงูุชุฏุงุฎู**: ุฌููุน ุงููุฑุถู ุงูู 3 ูุณุฌููู ูู ููุณ ููุช ุงูุจุฏุงูุฉ (ูุซูุงู 10:00). ูุฌุจ ุนูู ููุธู ุงูุงุณุชูุจุงู ุชูุฌูููู ุจุงูุฏุฎูู ุชุจุงุนุงู.
