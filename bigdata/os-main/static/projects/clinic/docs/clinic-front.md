# واجهة العيادات (Clinic Frontend)

تعمل واجهة العيادات بنظام **Mishkah**، وهي مبنية على فلسفة الملفات المتعددة ولكنها تعتمد في جوهرها على نواة **Mishkah Core** و **Mishkah UI**.

## 1. الأساس التقني (Architecture)

الواجهة ليست مجرد صفحات HTML/JS تقليدية، بل هي تطبيق SPA (Single Page Application) ديناميكي يعتمد على:

- **Mishkah DSL**: لغة تعريف الواجهة. بدلاً من كتابة HTML، نكتب كائنات JS تصف الواجهة، والمحرك (`M.DSL`) يقوم برسمها.
- **Mishkah REST**: طبقة الاتصال بالخادم. توفر دوال مثل `M.REST.repo('table_name')` للتعامل مع البيانات بسهولة.
- **Universal Components (UC)**: مكتبة مكونات جاهزة (أزرار، حقول إدخال، جداول) تضمن توحيد التصميم.

## 2. لوحة التحكم الديناميكية (Dynamic Dashboard)

لوحة التحكم (`dashboard.js`) هي العقل المدبر للواجهة. هي ليست صفحة ثابتة، بل محرك يقوم بقراءة `schema` وبناء الواجهة بناءً عليها.

### المكونات الرئيسية

1. **الشريط الجانبي (Sidebar)**: لا يتم كتابته يدوياً. النظام يقرأ الـ `modules` من الهيكل (مثل: الرعاية الصحية، المالية) ويبني القوائم تلقائياً.
2. **إدارة الحالة (State Management)**: يستخدم التطبيق نظام حالة مركزي (`app.setState`) يدير:
    - `activeTable`: الجدول المعروض حالياً.
    - `activeScreen`: الشاشة النشطة (إعدادات، بروفايل، تعاقدات).
    - `env`: إعدادات البيئة (اللغة، السمة).

## 3. نظام إدارة البيانات (CRUD System)

الجزء الأكثر قوة في الواجهة. عند النقر على أي جدول في القائمة الجانبية:

1. النظام يقرأ تعريف الجدول من الهيكل (`columns`, `smart_features`).
2. يولد "شبكة بيانات" (Data Grid) تلقائياً تعرض الأعمدة المناسبة.
3. يولد "نموذج إدخال" (Form) تلقائياً بناءً على أنواع الحقول (نص، تاريخ، علاقة).
4. يدير عمليات البحث، الفلترة، والترتيب دون كتابة كود مخصص لكل جدول.

**الميزة الكبرى:** إذا أضفت حقلاً جديداً في قاعدة البيانات، يظهر فوراً في الواجهة دون تعديل سطر كود واحد في الـ Frontend.

## 4. الشاشات المتخصصة (Specialized Screens)

بجانب النظام الديناميكي العام، يحتوي التطبيق على شاشات مصممة خصيصاً لمهام معقدة لا يمكن للـ CRUD العادي تغطيتها:

- **الشاشة الرئيسية (`home`)**: تعرض إحصائيات سريعة، آخر الحجوزات، ورسوم بيانية.
- **التعاقدات (`contracts`)**: شاشة معقدة لإدارة عقود المرضى والباقات (سيتم شرحها بالتفصيل في `contracts-frontend.md`).
- **الحجوزات (`bookings`)**: نظام تقويم (Calendar) وجدولة ذكي.
- **البروفايل (`profiles`)**: ملف المريض الشامل (السجل الطبي، الفواتير، المواعيد).

هذا المزيج بين "الديناميكية المريحة" و "التخصص الدقيق" هو ما يميز نظام العيادات.
